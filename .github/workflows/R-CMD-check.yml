# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
#
# See https://github.com/r-lib/actions/tree/master/examples#readme for
# additional example workflows available for the R community.

name: R-CMD-check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  R-CMD-check:
    build:
      #    runs-on: macOS-latest
      runs-on: ${{ matrix.config.os }}
      
      name: ${{ matrix.config.os }} (${{ matrix.config.r }})

      strategy:
        matrix:
          config:
            # - { os: windows-latest, r: 'release'}
            - { os: macos-latest, r: 'release'}
            # - { os: ubuntu-20.04, r: 'release', rspm: "https://packagemanager.rstudio.com/cran/__linux__/focal/latest"}

      env:
        GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
        R_KEEP_PKG_SOURCE: yes
            
            
        steps:
          - uses: actions/checkout@v3
            
          - uses: r-lib/actions/setup-pandoc@v2
          
          - uses: r-lib/actions/setup-r@v2
            with:
              r-version: ${{ matrix.config.r }}
              http-user-agent: ${{ matrix.config.http-user-agent }}
              use-public-rspm: true

          - uses: r-lib/actions/setup-r-dependencies@v2
            with:
               extra-packages: any::rcmdcheck
               needs: check

          - uses: r-lib/actions/check-r-package@v2
            with:
              upload-snapshots: true

          # - name: Install dependencies
          #   run: |
          #     install.packages(c("remotes", "rcmdcheck", "covr"))
          #     remotes::install_deps(dependencies = TRUE)
          #     shell: Rscript {0}
          #     - name: Check
          #       run: rcmdcheck::rcmdcheck(args = "--no-manual", error_on = "error")
          #       shell: Rscript {0}
          #     - name: Coverage
          #       run: covr::codecov()
          #       shell: Rscript {0}
...
